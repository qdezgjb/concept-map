# 概念图自动生成系统

基于DeepSeek AI的智能概念图生成与编辑平台，支持关键词生成、文本分析、交互式编辑等功能。

## 🚀 新功能：Sugiyama智能布局算法

✅ **Sugiyama算法集成** - 基于经典层次布局算法的优化实现  
✅ **智能布局选择** - 自动分析图形结构，选择最优布局算法  
✅ **防重叠设计** - 节点自动避让，连线智能路由  
✅ **多种布局模式** - Sugiyama、力导向两种布局  
✅ **美观优化** - 自动调整间距和位置，保持图形简洁美观  

## 🎯 Sugiyama智能布局算法详解

### 🔧 核心算法特性

**1. Sugiyama算法实现**
- **层次分配**: 自动分析节点层次关系，合理分配层级
- **节点排序**: 使用重心排序算法减少连线交叉
- **坐标分配**: 智能分配节点坐标，保持层次清晰
- **连线优化**: 优化连线路由，避免视觉混乱

**2. 智能布局选择**
- **结构分析**: 自动分析图形结构特征
- **算法匹配**: 根据结构特征选择最适合的布局算法
- **动态调整**: 实时优化布局效果

**3. 防重叠机制**
- **节点斥力**: 自动计算节点间斥力，防止重叠
- **智能间距**: 根据节点大小动态调整最小间距
- **边界约束**: 确保所有节点在可视区域内

### 📐 布局算法类型

#### **1. 智能布局（默认）**
- **适用场景**: 通用概念图，自动选择最优布局
- **特点**: 结合多种算法优势，自动优化
- **算法**: 智能分析 + 自动选择 + 动态优化

#### **2. Sugiyama布局**
- **适用场景**: 有明确层级关系的概念
- **特点**: 层次清晰，交叉最少，结构美观
- **算法**: 层次分配 + 节点排序 + 坐标分配

#### **3. 力导向布局**
- **适用场景**: 关系复杂的网络图
- **特点**: 节点自然分布，连线长度均匀
- **参数**: 节点间距100px，连线长度120px



### 🎨 美观优化特性

**1. 视觉平衡**
- 节点分布均匀，避免聚集
- 连线长度适中，减少视觉混乱
- 整体布局对称美观

**2. 交互体验**
- 支持拖拽调整节点位置
- 实时预览布局效果
- 一键应用不同布局算法

**3. 自适应调整**
- 根据节点数量自动调整参数
- 支持不同尺寸的画布
- 响应式布局适配

## 🚀 新功能：DeepSeek AI集成

✅ **已集成DeepSeek API** - 使用真实的AI模型生成概念图  
✅ **智能概念提取** - 自动分析关键词和描述文字  
✅ **布局优化建议** - AI推荐最优的布局算法  
✅ **实时API调用** - 网页端直接与DeepSeek AI交互  

## 功能特性

### 🚀 核心功能
- **关键词生成概念图**: 输入一个关键词，DeepSeek AI自动生成相关概念图
- **文本分析生成概念图**: 输入一段描述文字，AI分析并生成概念图
- **交互式编辑**: 支持拖拽、编辑、添加/删除节点和连线

### ✏️ 编辑工具
- **节点操作**: 添加、删除、编辑节点
- **连线操作**: 添加、删除、编辑连线
- **布局控制**: 力导向、层次、圆形、网格等多种布局算法
- **样式设置**: 节点颜色、形状，连线样式等

### 💾 数据管理
- **保存/加载**: 支持JSON格式的概念图文件
- **撤销/重做**: 操作历史记录管理
- **导出功能**: 支持多种格式导出

## 技术架构

- **前端**: HTML5 + CSS3 + JavaScript (ES6+)
- **后端**: Python + Flask + DeepSeek API (简化版)
- **可视化**: 原生SVG + 智能布局算法
- **AI集成**: DeepSeek API (已集成)
- **布局算法**: 力导向、层次、圆形、网格等算法

## 快速开始

### 1. 启动后端服务

```bash
# Windows用户双击运行根目录下的
start.bat

# 系统将自动：
# - 检测可用端口
# - 启动Flask服务
# - 自动打开浏览器显示概念图系统
# - 显示实际使用的端口号

# 或手动启动
pip install -r requirements.txt
cd llm
python app.py
```

### 2. 打开网页端

在浏览器中打开 `web/index.html` 文件即可使用。

### 3. 生成概念图

#### 方式一：关键词生成
1. 在左侧"关键词生成概念图"区域输入中心概念（如"辛亥革命"）
2. 点击"生成概念图"按钮
3. 系统将自动：
   - 在上半部分生成概念图（图形窗口）
   - 在下半部分生成AI介绍文字（50-100字）

#### 方式二：文本分析
1. 在左侧"文本分析生成概念图"区域输入描述文字
2. 点击"分析生成"按钮
3. 系统将自动：
   - 在上半部分生成概念图（图形窗口）
   - 在下半部分显示用户输入内容
   - 直接从用户输入中提取三元组关系

### 4. 编辑概念图
生成概念图后，可以使用右侧的编辑工具栏：
- 添加/删除/编辑节点和连线
- 调整布局算法
- 修改颜色和样式

### 5. 应用智能布局
- **自动布局**: 点击"🔄 自动布局"按钮应用智能布局
- **选择布局**: 使用布局选择器切换不同算法
- **实时预览**: 布局变化实时显示

### 6. 下载和保存
- 使用状态栏的下载按钮将概念图保存为PNG图片
- 使用加载数据按钮加载之前保存的JSON文件

## 使用说明

### 界面布局
- **左侧**: 功能选择区域，包含生成和编辑功能
- **右侧**: 概念图展示和编辑区域
- **顶部**: 系统标题和说明
- **底部**: 系统版本信息

### 操作流程
1. **启动服务** → 运行Python后端服务
2. **输入内容** → 选择生成方式并输入关键词或描述
3. **AI生成** → DeepSeek AI分析并生成概念图
4. **智能布局** → 自动应用最优布局算法
5. **编辑优化** → 使用编辑工具调整节点位置和样式
6. **布局切换** → 尝试不同布局算法找到最佳效果
7. **下载保存** → 下载PNG图片或保存JSON数据

### 布局算法选择建议

**选择Sugiyama布局当：**
- 概念有明确的层级关系
- 需要展示从属关系
- 希望结构清晰，交叉最少
- 适合组织架构、流程图等

**选择力导向布局当：**
- 概念关系复杂，相互连接较多
- 希望节点自然分布，避免人工痕迹
- 需要展示网络的整体结构



## 技术特点

### 🧠 智能算法
- **物理模拟**: 基于真实物理力的布局算法
- **自适应参数**: 根据图形复杂度自动调整参数
- **收敛优化**: 使用模拟退火算法确保最优解
- **文本分析**: 直接从用户输入中提取概念关系，无需额外AI生成

### 🎨 视觉优化
- **统一连线样式**: 所有连线使用直线连接，中间断开显示文字说明
- **防重叠设计**: 通过节点位置调整避免连线重叠
- **美观布局**: 保持图形的视觉平衡和对称性
- **响应式设计**: 支持不同尺寸的画布和屏幕

### ⚡ 性能优化
- **高效算法**: 优化的力导向算法，支持大量节点
- **智能缓存**: 避免重复计算，提升响应速度
- **渐进式渲染**: 支持大图的渐进式布局优化

## 更新日志

### v1.2.0 (最新)
- ✨ 新增Sugiyama层次布局算法
- ✨ 智能布局选择：自动分析图形结构，选择最优算法
- ✨ 支持两种布局模式：Sugiyama（默认）、力导向
- ✨ 防重叠和连线优化
- ✨ 美观布局自动调整
- ✨ 下载功能优化：保存按钮改为下载PNG图片
- ✨ 文本分析功能优化：直接分析用户输入，无需AI生成介绍
- ✨ 连线样式统一：所有连线使用直线连接，中间断开显示文字说明
- 🐛 修复节点拖拽问题
- 🐛 优化连线渲染性能

### v1.0.0
- 🎉 初始版本发布
- ✨ DeepSeek AI集成
- ✨ 基础概念图生成
- ✨ 交互式编辑功能 